define(["require","./normalize"],function(e,r){function n(e){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){try{var r=require.nodeRequire("csso")}catch(n){return console.log('Compression module not installed. Use "npm install csso -g" to enable.'),e}var t=e.length;try{e=r.justDoIt(e)}catch(n){return console.log("Compression failed due to a CSS syntax error."),e}return console.log("Compressed CSS output to "+Math.round(100*(e.length/t))+"%."),e}return console.log("Compression not supported outside of nodejs environments."),e}function t(e){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){var r=require.nodeRequire("fs"),n=r.readFileSync(e,"utf8");return 0===n.indexOf("ï»¿")?n.substring(1):n}var t,o,n=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8"));try{for(t=new java.lang.StringBuffer,o=a.readLine(),o&&o.length()&&65279===o.charAt(0)&&(o=o.substring(1)),t.append(o);null!==(o=a.readLine());)t.append(s).append(o);return String(t.toString())}finally{a.close()}}function o(e,r){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){var n=require.nodeRequire("fs");n.writeFileSync(e,r,"utf8")}else{var t=new java.lang.String(r),o=new java.io.BufferedWriter(new java.io.OutputStreamWriter(new java.io.FileOutputStream(e),"utf-8"));try{o.write(t,0,t.length()),o.flush()}finally{o.close()}}}function s(e){return e.replace(/(["'\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")}var a,i={},u=!!process.platform.match(/^win/),l=/^([^\:\/]+:\/)?\//,c=e.toUrl("base_url").split("/");c[c.length-1]="",c.join("/");var d,p=[],f={};return i.load=function(e,n,o,s){if(d=d||s,a||(a=path.resolve(d.dir||path.dirname(d.out),d.siteRoot||".")+"/",u&&(a=a.replace(/\\/g,"/"))),e.match(l))return o();var i=n.toUrl(e+".css");f[e]=r(t(i),u?i.replace(/\\/g,"/"):i,a),o()},i.normalize=function(e,r){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),r(e)},i.write=function(e,r,n){r.match(l)||(p.push(f[r]),0!=d.buildCSS&&n.asModule(e+"!"+r,"define(function(){})"))},i.onLayerEnd=function(e,r){var t=p.join("");if(d.separateCSS){console.log("Writing CSS! file: "+r.name+"\n");var a=d.appDir?d.baseUrl+r.name+".css":d.out.replace(/(\.js)?$/,".css");o(a,n(t))}else if(0!=d.buildCSS){if(""==t)return;e("(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('"+s(n(t))+"');\n")}p=[]},i});